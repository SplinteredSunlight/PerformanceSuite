<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        .box {
            position: absolute;
            width: 200px;
            height: 150px;
            background-color: #2c3e50;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            padding: 15px;
            cursor: move;
            user-select: none;
            display: flex;
            flex-direction: column;
        }
        
        .box h2 {
            margin-top: 0;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        
        .box-content {
            flex: 1;
            overflow: auto;
        }
        
        .box1 {
            top: 50px;
            left: 50px;
            background-color: #3498db;
            color: white;
        }
        
        .box2 {
            top: 100px;
            left: 300px;
            background-color: #e74c3c;
            color: white;
        }
        
        .box3 {
            top: 250px;
            left: 150px;
            background-color: #2ecc71;
            color: white;
        }
        
        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
        }
        
        .resize-handle-se {
            bottom: 5px;
            right: 5px;
            cursor: nwse-resize;
        }
        
        .add-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .add-button:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>
    <button class="add-button" id="add-box">Add Box</button>
    
    <div class="container" id="container">
        <div class="box box1" id="box1">
            <h2>Box 1</h2>
            <div class="box-content">
                <p>This is a draggable box. You can move it around the screen.</p>
            </div>
            <div class="resize-handle resize-handle-se"></div>
        </div>
        
        <div class="box box2" id="box2">
            <h2>Box 2</h2>
            <div class="box-content">
                <p>This is another draggable box. You can also resize it using the handle in the bottom-right corner.</p>
            </div>
            <div class="resize-handle resize-handle-se"></div>
        </div>
        
        <div class="box box3" id="box3">
            <h2>Box 3</h2>
            <div class="box-content">
                <p>Try dragging and resizing these boxes to see how it works.</p>
            </div>
            <div class="resize-handle resize-handle-se"></div>
        </div>
    </div>
    
    <script>
        // Global variables
        let draggedElement = null;
        let boxCounter = 4; // Start from 4 since we already have boxes 1-3
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Make all boxes draggable
            const boxes = document.querySelectorAll('.box');
            boxes.forEach(box => {
                makeDraggable(box);
                makeResizable(box);
            });
            
            // Add event listener for the "Add Box" button
            document.getElementById('add-box').addEventListener('click', createNewBox);
            
            // Add global event listeners for drag and drop
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('mouseup', handleDragEnd);
        });
        
        // Make an element draggable
        function makeDraggable(element) {
            element.addEventListener('mousedown', function(e) {
                // Skip if clicking on resize handle
                if (e.target.classList.contains('resize-handle')) return;
                
                e.preventDefault();
                
                // Calculate the offset of the mouse pointer from the element's top-left corner
                const rect = element.getBoundingClientRect();
                const offsetX = e.clientX - rect.left;
                const offsetY = e.clientY - rect.top;
                
                // Set the dragged element
                draggedElement = {
                    element: element,
                    offsetX: offsetX,
                    offsetY: offsetY
                };
                
                // Bring to front
                element.style.zIndex = '100';
            });
        }
        
        // Handle drag move
        function handleDragMove(e) {
            if (!draggedElement) return;
            
            const element = draggedElement.element;
            
            // Calculate new position
            const newLeft = e.clientX - draggedElement.offsetX;
            const newTop = e.clientY - draggedElement.offsetY;
            
            // Update position
            element.style.left = newLeft + 'px';
            element.style.top = newTop + 'px';
        }
        
        // Handle drag end
        function handleDragEnd(e) {
            if (!draggedElement) return;
            
            // Reset z-index
            draggedElement.element.style.zIndex = '10';
            
            // Clear dragged element
            draggedElement = null;
        }
        
        // Make an element resizable
        function makeResizable(element) {
            const resizeHandle = element.querySelector('.resize-handle-se');
            
            if (resizeHandle) {
                resizeHandle.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    e.stopPropagation(); // Prevent dragging when resizing
                    
                    const startX = e.clientX;
                    const startY = e.clientY;
                    const startWidth = element.offsetWidth;
                    const startHeight = element.offsetHeight;
                    
                    function resize(e) {
                        const newWidth = startWidth + e.clientX - startX;
                        const newHeight = startHeight + e.clientY - startY;
                        
                        // Set minimum size
                        element.style.width = Math.max(100, newWidth) + 'px';
                        element.style.height = Math.max(80, newHeight) + 'px';
                    }
                    
                    function stopResize() {
                        window.removeEventListener('mousemove', resize);
                        window.removeEventListener('mouseup', stopResize);
                    }
                    
                    window.addEventListener('mousemove', resize);
                    window.addEventListener('mouseup', stopResize);
                });
            }
        }
        
        // Create a new box
        function createNewBox() {
            const container = document.getElementById('container');
            
            // Create a new box element
            const newBox = document.createElement('div');
            newBox.className = 'box';
            newBox.id = 'box' + boxCounter;
            
            // Set random position
            const maxX = window.innerWidth - 250;
            const maxY = window.innerHeight - 200;
            const randomX = Math.floor(Math.random() * maxX);
            const randomY = Math.floor(Math.random() * maxY);
            
            newBox.style.left = randomX + 'px';
            newBox.style.top = randomY + 'px';
            
            // Set random background color
            const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            newBox.style.backgroundColor = randomColor;
            
            // Add content
            newBox.innerHTML = `
                <h2>Box ${boxCounter}</h2>
                <div class="box-content">
                    <p>This is a new draggable and resizable box.</p>
                </div>
                <div class="resize-handle resize-handle-se"></div>
            `;
            
            // Add to container
            container.appendChild(newBox);
            
            // Make it draggable and resizable
            makeDraggable(newBox);
            makeResizable(newBox);
            
            // Increment counter
            boxCounter++;
        }
    </script>
</body>
</html>